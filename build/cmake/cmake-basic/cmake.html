<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>cmake introduction</title>
	<link rel="stylesheet" href="https://rawgit.com/hakimel/reveal.js/master/css/reveal.css">
	<link rel="stylesheet" href="https://rawgit.com/hakimel/reveal.js/master/css/theme/moon.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/xt256.min.css">
</head>

	<body>

		<div class="reveal">

			<div class="slides">

				<section>
					<section>
						<h1>CMake</h1>
					</section>

					<section>
						<h1>about @me</h1>
						<a href="https://www.linkedin.com/in/kokaipeter"><i class="fa fa-linkedin-square fa-3x" aria-hidden="true"></i></a>
						<a href="https://github.com/Kokan"><i class="fa fa-github fa-3x" aria-hidden="true"></i></a>
						<a href="mailto:kokaipeter@gmail.com"><i class="fa fa-at fa-3x" aria-hidden="true"></i></a>
						<a href="http://kokan.github.io"><i class="fa fa-book fa-3x" aria-hidden="true"></i></a>
						<a href="https://twitter.com/K0k4n"><i class="fa fa-twitter fa-3x" aria-hidden="true"></i></a>
					</section>
				</section>

				<section>
					<section>
						<h1>Agenda</h1>

						<ul>
							<li class="fragment" data-fragment-index="1">Yet another build tool</li>
							<li class="fragment" data-fragment-index="2">...</li>
						</ul>
					</section>
				</section>

				<section>
					<section>
						<h1>Yet another bulid tool</h1>
					</section>

					<section>
						<h1>Some basic facts</h1>

						<ul>
							<li class="fragment" data-fragment-index="1">CMake is a tool to generate a build system</li>
							<li class="fragment" data-fragment-index="2">Cross platform</li>
							<li class="fragment" data-fragment-index="3">Source code: CMakeLists.txt, and .cmake files</li>
						</ul>
					</section>

					<section>
						<h1>How to build ?</h1>

						<ul>
							<li>Generate build system</li>
						</ul>

						<pre><code class="bash" data-trim data-noescape>
~/workspace/projecta/build> cmake ~/workspace/projecta/source
-- The C compiler identification is Clang 6.0.0
-- Check for working C compiler: /usr/bin/ccache
-- Check for working C compiler: /usr/bin/ccache -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
...
-- Configuring done
-- Generating done
-- Build files have been written to: ~/workspace/projecta/build
						</code></pre>
					</section>

					<section>
						<h1>How to build ?</h1>

						<ul>
							<li>Build</li>
						</ul>

						<pre><code class="bash" data-trim data-noescape>
~/workspace/projecta/build> make
[  4%] Built target hoo
[  8%] Built target boo
...
[100%] Built target boohoo
[100%] Building C object boohoo/CMakeFiles/boohoo.dir/boohoo.c.o
[100%] Linking C executable boohoo
[100%] Built target boohoo
						</code></pre>
					</section>

					<section>
						<h1>Targets</h1>

						<ul>
							<li>help</li>
							<li>all (default)</li>
							<li>install</li>
							<li>clean</li>
							<li>test</li>
						</ul>

					</section>

					<section>
						<h1>Configuring cmake</h1>

						<img src="img/ccmake.png" style="background: transparent; border: none; box-shadow: none;"></img>
						<img src="img/cmake-gui.png" style="background: transparent; border: none; box-shadow: none; "></img>

					</section>

					<section>
						<h1>cmake options</h1>

						<ul>
							<li>Set variable: -D VAR=VALUE or -DVAR=VALUE</li>
							<li>Select generator: -G Ninja</li>
							<li>List variables and values: -LH</li>
						</ul>
					</section>

					<section>
						<h1>Variables</h1>

						<ul>
							<li>CMAKE_BUILD_TYPE</li>
							<li>CMAKE_INSTALL_PREFIX</li>
							<li>CMAKE_VERBOSE_MAKEFILE</li>
						</ul>
					</section>
				</section>

				<section>
					<section>
						<h1>How to test?</h1>

					<pre><code class="cmake" data-trim data-noescape>
~/workspace/projecta/build> make test
[0/1] Running tests...
Test project ~/workspace/projecta/build
        Start   1: test_a
  1/5   Test   #1: test_a ............................   Passed    0.03 sec
...
        Start   5: test_b
  5/5   Test   #5: test_b ............................   Passed    0.02 sec
100% tests passed, 0 tests failed out of 5

Total Test time (real) =  32.67 sec
					</code></pre>
					</section>

					<section>
						<h1>ctest</h1>

					<pre><code class="cmake" data-trim data-noescape>
~/workspace/projecta/build> ctest
[0/1] Running tests...
Test project ~/workspace/projecta/build
        Start   1: test_a
  1/5   Test   #1: test_a ............................   Passed    0.03 sec
...
        Start   5: test_b
  5/5   Test   #5: test_b ............................   Passed    0.02 sec
100% tests passed, 0 tests failed out of 5

Total Test time (real) =  32.67 sec
					</code></pre>
					</section>

					<section>
						<h1>ctest</h1>

						<ul>
							<li>Source: CTestTestfile.cmake (generated)</li>
							<li>Parallel: -j</li>
							<li>Verbose: -V</li>
							<li>Match running: -R</li>
							<li>Random execution order: --schedule-random</li>
						</ul>
					</section>

					<section>
						<h1>cdash</h1>

						<pre><code class="cmake" data-trim data-noescape>Experimental
   Site: peterkokai-work
   Build name: Linux-ccache
Create new tag: 20180702-0501 - Experimental
Configure project
   Each . represents 1024 bytes of output
    . Size of output: 0K
Build project
   Each symbol represents 1024 bytes of output.
   '!' represents an error and '*' a warning.
    .***********************..........................  Size: 50K
...
    ................ Size of output: 416K
   0 Compiler errors
   50 or more Compiler warnings
						</code></pre>
					</section>

					<section>
						<h1>cdash</h1>

						<ul>
							<li>ctest [Model][Action]</li>
							<li>ctest -M [Model] -T [Action]</li>
							<li>Models: Experimental, Continuous, Nightly</li>
							<li>Action: Start, Update, Build, Test, MemCheck, Coverage, Submit, Configure</li>
							<li>Example: ExperimentalMemCheck</li>
						</ul>
					</section>

					<section>
						<h1>ExperimentalMemCheck</h1>

						<pre><code class="cmake" data-trim data-noescape>Experimental
Total Test time (real) = 251.58 sec
-- Processing memory checking output:
17/131 MemCheck: #17: test_logproto .....................   Defects: 78
20/131 MemCheck: #20: test_stats_cluster ................   Defects: 4
38/131 MemCheck: #38: test_evtrec .......................   Defects: 2
...
98/131 MemCheck: #98: test_geoip2_parser ................   Defects: 12
105/131 MemCheck: #105: test_kv_parser ....................   Defects: 2
114/131 MemCheck: #114: test_systemd_journal ..............   Defects: 1
MemCheck log files can be found here: ( * corresponds to test number)
/home/peterkokai/github.com/syslog-ng/build/Testing/Temporary/MemoryChecker.*.log
Memory checking results:
Memory Leak - 132
Built target ExperimentalMemCheck
						</code></pre>
					</section>
				</section>

				<section id="cmake-user-guide">
					<section>
						<h1>Bonus</h1>

						<ul>
							<li>Graphiz</li>
							<li>Generators</li>
						</ul>
					</section>

					<section>
						<h1>Graphiz</h1>

						<a href="img/foo-all.png" target="_blank"><img src="img/foo-all.png" style="background: transparent; border: none; box-shadow: none;"></img></a>

					</section>

					<section>
						<h1>Graphiz</h1>

						<pre><code class="cmake" data-trim data-noescape>
~/workspace/projecta/build> cmake --graphviz=/tmp/foo/foo .
~/workspace/projecta/build> dot /tmp/foo/foo -Tpng -o foo.png
						</code></pre>

					</section>
				</section>

				<section id="cmake-user-guide">
					<pre><code class="cmake" data-trim data-noescape>
cmake_project(Foo C)

					</code></pre>
				</section>


				<section>
					<i class="fa fa-question fa-5x" aria-hidden="true"></i>
					<i class="fa fa-lightbulb-o fa-5x" aria-hidden="true"></i>
				</section>

			</div>

		</div>

		<script src="https://use.fontawesome.com/19010dbc51.js"></script>

		<script type="text/javascript" src="https://rawgit.com/hakimel/reveal.js/master/js/reveal.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

		<script>
			Reveal.initialize({
				width: '100%',
				height: '100%'
			});
			hljs.initHighlightingOnLoad();
		</script>

</body>
</html>
